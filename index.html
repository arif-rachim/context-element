<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="src/index.ts"></script>
</head>
<body>
<data-element id="data-element">
    <input input.action="SET_TODO" name="todo" type="text" value.watch="todo">
    <button click.action="ADD_TODO">Add Todo</button>
    <data-group data-key="id" data.watch="todos" reducer.watch="itemReducer">
        <div>
            <label>
                <input checked.watch="done" input.action="TOGGLE_TODO" type="checkbox">
                <span content.watch="todo"></span>
            </label>
        </div>
    </data-group>
</data-element>
</body>
<script>

    const dataElement = document.getElementById('data-element');
    const itemReducer = (array, action) => {
        switch (action.type) {
            case 'DELETE_TODO' : {
                return [...array.filter((data, index) => index !== action.index)];
            }
            case 'TOGGLE_TODO' : {
                return [...array.slice(0, action.index), {
                    ...action.data,
                    done: !action.data.done
                }, ...array.slice((action.index + 1), array.length)];
            }
        }
        return [...array];
    };
    dataElement.setDataProvider(() => ({todo: '', todos: [], itemReducer}));
    dataElement.reducer = (context, action) => {
        switch (action.type) {
            case 'SET_TODO' : {
                const value = action.event.target.value;
                return {...context, todo: value}
            }
            case 'ADD_TODO' : {
                const {todo, todos} = context;
                let newTodos = [...todos, {todo, done: false, id: Math.round(Math.random() * 100000)}];
                return {...context, todos: newTodos, todo: ''};
            }
        }
        return {...context};
    }
</script>
</html>
