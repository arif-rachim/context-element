<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="src/index.ts"></script>
</head>
<body>

<data-element id="data-element">
    <form submit.action="ADD_TODO">
        <input input.action="SET_TODO" name="todo" type="text" value.watch="todo">
        <button type="submit">Add Todo</button>
    </form>
    <div>
        <data-group data-key="id" data.watch="todos" reducer.watch="itemReducer" style="display: table">
            <div style="display: table-row">
                <div click.action="TOGGLE_TODO" style="display: table-cell"><input checked.watch="done" type="checkbox">
                </div>
                <div click.action="TOGGLE_TODO" style="display: table-cell">
                    <div watch="todo"></div>
                </div>
                <div style="display: table-cell">
                    <button click.action="DELETE_TODO">Delete</button>
                </div>
            </div>
        </data-group>
    </div>
</data-element>
</body>
<script>

    const dataElement = document.getElementById('data-element');
    const itemReducer = (array, action) => {
        switch (action.type) {
            case 'DELETE_TODO' : {
                return [...array.filter((data, index) => index !== action.index)];
            }
            case 'TOGGLE_TODO' : {
                return [...array.slice(0, action.index), {
                    ...action.data,
                    done: !action.data.done
                }, ...array.slice((action.index + 1), array.length)];
            }
        }
        return [...array];
    };
    dataElement.data = {
        todo: '',
        todos: [{todo: 'Todo One', id: 'Todo One'}, {todo: 'Todo Two', id: 'Todo Two'}],
        itemReducer
    };
    dataElement.reducer = (context, action) => {
        switch (action.type) {
            case 'SET_TODO' : {
                const value = action.event.target.value;
                return {...context, todo: value}
            }
            case 'ADD_TODO' : {
                const {todo, todos} = context;
                let newTodos = [...todos, {todo, done: false, id: Math.round(Math.random() * 100000)}];
                return {...context, todos: newTodos, todo: ''};
            }
        }
        return {...context};
    }
</script>
</html>
